<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="这是一个副标题">
<title>MK测试</title>

<link rel='canonical' href='https://example.com/p/test-chinese/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Chinese Test">
<meta property='og:description' content="这是一个副标题">
<meta property='og:url' content='https://example.com/p/test-chinese/'>
<meta property='og:site_name' content='演示站点'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2020-09-09T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2020-09-09T00:00:00&#43;00:00'/><meta property='og:image' content='https://example.com/p/test-chinese/helena-hertz-wWZzXlDpMog-unsplash.jpg' />
<meta name="twitter:title" content="Chinese Test">
<meta name="twitter:description" content="这是一个副标题"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://example.com/p/test-chinese/helena-hertz-wWZzXlDpMog-unsplash.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_f509edb42ecc0ebd.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">演示站点</a></h1>
            <h2 class="site-description">演示说明</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#对象字典概述">对象字典概述</a></li>
    <li><a href="#通讯对象子协议区communication-profile-area">通讯对象子协议区(Communication profile area)</a>
      <ol>
        <li><a href="#通用通讯对象general-communication-objects">通用通讯对象(General communication objects)</a></li>
      </ol>
    </li>
    <li><a href="#制造商特定子协议-manufacturer-specific-profile">制造商特定子协议 (Manufacturer specific Profile)</a></li>
    <li><a href="#标准化-设备子协议-standardized-profile-area-">标准化 设备子协议 Standardized profile area )</a></li>
  </ol>

  <ol>
    <li><a href="#nmt-节点状态">NMT 节点状态</a></li>
    <li><a href="#nmt-节点上线报文">NMT 节点上线报文</a></li>
    <li><a href="#nmt-节点状态与心跳报文">NMT 节点状态与心跳报文</a></li>
    <li><a href="#nmt-节点守护">NMT 节点守护</a></li>
    <li><a href="#nmt-节点状态切换命令">NMT 节点状态切换命令</a></li>
    <li><a href="#canopen-主站设备">CANopen 主站设备</a></li>
  </ol>

  <ol>
    <li><a href="#pdo-的-can-id-定义">PDO 的 CAN-ID 定义</a></li>
    <li><a href="#pdo-的传输形式">PDO 的传输形式</a></li>
    <li><a href="#pdo-的通信参数">PDO 的通信参数</a></li>
    <li><a href="#pdo-的映射参数">PDO 的映射参数</a></li>
  </ol>

  <ol>
    <li><a href="#通讯原则communication-principle">通讯原则（communication principle）</a></li>
    <li><a href="#快速-sdo-协议expedited-sdo-protocol">快速 SDO 协议(Expedited SDO protocol)</a></li>
    <li><a href="#普通-sdo-协议normal-sdo-protocol">普通 SDO 协议(Normal SDO protocol)</a></li>
  </ol>

  <ol>
    <li><a href="#13-紧急报文协议emergency-protocol">13. 紧急报文协议（Emergency protocol）</a>
      <ol>
        <li><a href="#1-初始化sdo块下载">1. 初始化SDO块下载</a></li>
        <li><a href="#2-从节点响应">2. 从节点响应</a></li>
        <li><a href="#3-主节点发送数据">3. 主节点发送数据</a></li>
        <li><a href="#4-从节点确认数据">4. 从节点确认数据</a></li>
        <li><a href="#5-完成块下载">5. 完成块下载</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/test-chinese/">
                <img src="/p/test-chinese/helena-hertz-wWZzXlDpMog-unsplash_hu_e5aaa5f0b7bd07e9.jpg"
                        srcset="/p/test-chinese/helena-hertz-wWZzXlDpMog-unsplash_hu_e5aaa5f0b7bd07e9.jpg 800w, /p/test-chinese/helena-hertz-wWZzXlDpMog-unsplash_hu_c99ba9c80ceee4b3.jpg 1600w"
                        width="800" 
                        height="600" 
                        loading="lazy"
                        alt="Featured image of post MK测试" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/test/" style="background-color: #2a9d8f; color: #fff;">
                Test
            </a>
        
            <a href="/categories/%E6%B5%8B%E8%AF%95/" >
                测试
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/test-chinese/">Chinese Test</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            这是一个副标题
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2020-9-9</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 2 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><a class="link" href="https://mpbeta.csdn.net/mp_blog/creation/editor/147810924"  target="_blank" rel="noopener"
    >CSDN</a></p>
<h1 id="1-前言">1. 前言
</h1><p>本教程适用于CIA CANopen协议DS301又名CIA301标准。 用户须已经掌握 CAN2.0A协议的基本知识。 即基本的帧结构、ID数据、DLC等知识， 本文不再从 CAN 底层开始叙述。</p>
<h1 id="2-canopen在-iso层级中的位置">2. CANopen在 ISO层级中的位置
</h1><p>从OSI的7层网络模型的角度来看同，(CAN Controller Area Network)现场总线仅仅定义了第 1 层 （物理层，见 ISO11898 2 标准） 、第 2 层 （数据链路层，见 ISO11898 1 标准）而在 实际设计中，这两层完全由硬件实现，设计人员无需再为此开发相关软件（ Software或固件（ Firmware ）），只要了解如何调用相关的接口和寄存器，即可完成对 CAN 的控制 。 如 图 2.1所示。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/b8a1fff3f57343969fe8557d8b528845.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>但CAN 没有规定应用层 。也就是 没有规定 与 实际应用 相关的 逻辑，比如开关量输入输 出 模拟量输入输出。所以 本身 对于应用来说，是 不完整 的 。这就像铁矿石（物理层）冶炼 成铁锭（数据链路层）， 然后针对具体应用，再加工做成汽车、轮船、钢筋、坦克、钢结构 建筑等等。 如 图 2.2 所示。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/e150e298aedc4a0b9375f792082377fe.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>因此，基本每个行业的CAN 应用，**都需要一个高层协议来定义CAN报文中的 11/29位标识符、8字节数据的使用。**但在 CAN 总线的工业自动化应用中， 由于设备的互通互联 的需求越来越多，所以 需要一个开放的、标准化的高层协议：这个协议支持各种 CAN 厂商设备的互用性、互换性，能够实现在 CAN 网络中提供标准的、统一的系统通讯模式，提供 设备功能描述方式，执行网络管理功能。 其中包括：</p>
<ul>
<li>应用层 Application layer ))：为网络中每一个有效设备都能 够提供一组有用的服务与协议。</li>
<li>通讯描述 Communication profile ))：提供配置设备、通讯数据的含义，定义数据通讯方式。</li>
<li>设备描述 Device proflile ))：为设备（类）增加符合规范的行为。</li>
</ul>
<p>CANopen协议通常分为用户应用层、对象字典以及通信三个部分。 其中最为核心的是对象字典，描述了应用对象和CANopen报文之间的关系。 CANopen通信是本文关键部分，其定义了CANopen协议通信规则以及与CAN控制器驱动之间对应关系，熟悉这部分对全面掌握CANopen协议至关重要。 用户应用层是用户根据实际的需求编写的应用对象，这部分本入门教程将不作详细。 </p>
<p><img src="https://i-blog.csdnimg.cn/direct/14873b2963a24005bc4dc2067156a604.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="3-canopen-的预定义报文id分类">3. CANopen 的预定义报文ID分类
</h1><p>在CANopen 创立之初，即使 在 CAN 总线应用最广泛的汽车电子行业，网络中的 CAN 节点数量和需要通讯的信息都是比较少的。人们使用 CAN 取代 RS485 主要是看重其可以 突发发送的实时性优势 ，而在多节点、长距离应用中 CAN 总线和 RS485 比起来并无优势， 比如同样的波特率下， CAN 的通信距离只能达到 RS485 的 0.6 0.8 倍 ，而多节点通信 CAN 无法进行任意的突发发送， 不得不遵循 RS485 那样的轮询通信机制，否则会导致拥堵。 就像这个十字路口的汽车，如果车只有 10 辆，即使没 有交通灯，根本不会拥堵。而如果有 100 辆，如果任意行驶，就会发生严重拥堵。 CANopen 的创始人是非常了解 CAN 总线这个特征，所以在设计 CANopen 时，对其定 义为 小网络 、 控制信号 的 实时通讯：</p>
<ul>
<li>报文传输采用 CAN 标准帧格式 。即 11bit 的 ID 域，以尽量减小传输时间；<img src="https://i-blog.csdnimg.cn/direct/386ca699683c41bba2f1fbf237dbaca8.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></li>
<li>网络控制报文均采用数据最小字节数。比如 心跳报文，只有 1 个字节数据；</li>
<li>实时更新的过程数据无需接收方报文应答 。即采用生产消费模型，降低总线负载；</li>
<li>需要接收方确认的配置参数一般都是采用快速单字传输。即 1 个报文最多传送1个32字节的参数变量，避免了分帧引起的实时性降低。 以上这些定义都是为了节约时间开销，最大限度保证实时性。 同时为了 减小简单网络的组态工作量， CANopen 定义了强制性的缺省标识符 CAN 帧 ID 分配表 ，以减少使用者与维护者的学习时间，快速上手。</li>
</ul>
<h1 id="4-网络管理nmt与特殊协议special-protocols报文id分类">4. 网络管理NMT与特殊协议(Special protocols)报文ID分类
</h1><p>虽然CANopen 的通讯发挥了 CAN 的特色，所有节点通信地位平等， 运行时允许自行发送报文，但 CANopen 网络为了稳定可靠可控，都需要设置一个 网络管理主机 NMT Master (Network Management Master )，就像一个交响乐团的指挥家，所有节点的启动、停止都是 有他进行指挥。</p>
<p>NMT主机 一般是 CANopen 网络中具备监控的 PLC 或者 PC （当然也可以是一般 的功能节点）， 所以也成为 CANopen 主站 。 相对应的其他 CANopen 节点就是 NMT 从机 (NMT slaves) 。 NMT主机和 NMT 从机之间通讯的报文就称为 NMT 网络管理报文 。管理报文负责层管理、网络管理和 ID 分配服务。例如，初始化、配置和网络管理（其中包括节点保护）。网络管理中，同一个网络中只允许有一个主节点、一个或多个从节点，并遵循主从模式。 另外，为了协调各个节点的同步、心跳、时间、错误提示 等通讯控制， CANopen 还定 义了一系列 特殊协议 Special protocols ）报文。 如图所示，为 CANopen 预定义报文 Pre-defined CAN-IDs ）的 NMT 报文和特殊协议报文。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/eb490e714f87493180e6345958a3d41d.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="5-过程数据对象-pdo-和服务数据对象-sdo-的报文-id-分类">5. 过程数据对象（ PDO ）和服务数据对象（ SDO 的报文 ID 分类
</h1><p>用户应用CANopen 时，需要传递的配置信息和应用信息都是放在 过程数据对象 PDO (Process data object) 和 服务数据对象 SDO (Service data) 里面。这些对象就和市场上卖水果的箩筐，大小是一样的，只是装的东西（应用数据）不一样，如 图 4 3 所示。这就是 CiA301 协议所规定的基础协议 —“箩筐 ”，而 CiA4xx 的子协议 或者用户自定义的对象就是“箩筐”里面的东西。 PDO和 SDO 的通讯区别在于 PDO 属于过程数据，即单向传输，无需接收节点回应CAN 报文来确认，从通讯术语上来说是属于“生产消费”模型 。如图所示。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/83bedb4f3acd46db9eca8ef909239cbb.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>而SDO 属于服务数据，有指定被接收节点的地址（ Node ID ），并且需要指定的接收节点回应 CAN 报文来确认已经接收， 如果超时没有确认，则发送节点将会重新发送原报文。 这种通讯方式属于常见的“服务器客户端”的通信模型 ，即我们通常所说的轮询式。如图所示。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/1d4235a97065463cb2648037bea533fa.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>对于PDO 和 SDO 的报文 ID 分配， 为了减少网络的组态工作量， CANopen 预定义了强制性的缺省标识符(CAN-ID ) 分配表，该分配表是基于 11 位 CAN-ID 的标准帧格式。 将其划分为 4 位的功能码 (Function ID) 和 7 位的节点号(Node ID) 。如 图 4.6 所示</p>
<p><img src="https://i-blog.csdnimg.cn/direct/1d0eeec3cb6548a5a93e6f7abf4dee58.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>PDO 和 SDO 的预定义连接 ID 分配</p>
<p>在CANopen 里也通常把 CAN ID 称为 COB ID （通信对象编号）。所以我们可以分清楚两个易于混淆的名称</p>
<ul>
<li>COB ID Communication Object Identifier 即 CANopen 中对某种通讯对象的报文帧ID ，即 CAN 报文的 11 位 ID 。代表了一种通讯含义。</li>
<li>Node ID ：节点 ID 号，即 CANopen 网络中的节点地址， CANopen 规定了逻辑上最大 128 个节点，所以 Node ID 最大为 128 （7 位）。</li>
</ul>
<p>COBID 和 Node ID 无必然联系，但在过程数据对象（ PDO ）和服务数据对象 SDO中， COB-ID 中包含了 Node-ID 。 由于需要区分每个CANopen 节点的输入和输出，所以 PDO 分为 TPDO （发送 PDO)和 RPDO(接收PDO)，发送和接收是以 CANopen 从站节点为参考 （如果 CAN 主站就相反）。 TPDO和RPDO 分别有 4 个数据对象 ，每种数据对象就是 1 条 CAN 报文封装 如 表 4 2 所示，这些都是数据收发的容器。而SDO 就相对 比较简单固定， 发起通讯的“问” SDO 的 CAN 帧 ID 就是 600 h +node ID这里的 Node ID 是被问的节点地址，而被问的节点应“答” SDO 的 CAN 帧 ID 就是 580 h+node ID 。一般在 CANopen 网络中，只有 NMT 主机能发起 SDO 通讯，进行节点参数配置或者关键性参数的传递。当然从节点也可以对其他从节点发起 SDO 通讯。 为 CANopen预定义报文的 PDO报文和SDO报文 中的ID分类 。 使用者务必牢记！</p>
<p><img src="https://i-blog.csdnimg.cn/direct/014d85e7b8f34a23b15b2509abf3b72b.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="6-对象字典-od-object-dictionary">6. 对象字典 OD Object dictionary
</h1><p>CANopen对象字典（OD: Object Dictionary）是CANopen协议最为核心的概念。所谓的对象字典就是一个有序的对象组，描述了对应CANopen节点的所有参数，包括通讯数据的存放位置也列入其索引，这个表变成可以传递形式就叫做EDS文件（电子数据文档Electronic Data Sheet）。对象字典，就像体检表，具备这个人每个功能的参数，便于用人单位（主站）进行合理分配工作。 每个对象采用一个16位的索引值来寻址，这个索引值通常被称为索引，其范围在0x0000到0xFFFF之间。为了避免数据大量时无索引可分配，所以在某些索引下也定义了一个8 位的索引值，这个索引值通常被称为子索引，其范围是0x00到0xFF之间。 每个索引内具体的参数，最大用32位的变量来表示，即Unsigned32，四个字节。 每个CANopen设备都有一个对象字典，使用电子数据文档（EDS文件）来记录这些参数，而不需要把这些参数记录在纸上。对于CANopen网络中的主节点来说，不需要对CANopen从节点的每个对象字典项都访问。 CANopen对象字典中的项由一系列子协议来描述。子协议为对象字典中的每个对象都描述了它的功能、名字、索引、子索引、数据类型，以及这个对象是否必需、读写属性等等，这样可保证不同厂商的同类型设备兼容。 CANopen协议的核心描述子协议是DS301，其包括了CANopen协议应用层及通信结构描述，其它的协议子协议都是对DS301 协议描述文本的补充与扩展。在不同的应用行业都会起草一份CANopen设备子协议，子协议编号一般是DS4xx 。</p>
<h2 id="对象字典概述">对象字典概述
</h2><p>如表所示，为对象字典索引区域定义，其中标绿色底纹的通讯对象子协议区和制造商特定子协议区是用户需要关注的区域。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/78fe0d021a904a7ba525cd5eff88c559.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="通讯对象子协议区communication-profile-area">通讯对象子协议区(Communication profile area)
</h2><p>通讯对象子协议区（Communication profile area）定义了所有和通信有关的对象参数，如表所示，标绿色底纹的索引范围1000h to 1029h为通用通讯对象，所有CANopen节点都必须具备这些索引，否则将无法加入CANopen网络。其他索引根据实际情况进行分配与定义。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/49b998a10e7c40a98655d10ec43ea7dd.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="通用通讯对象general-communication-objects">通用通讯对象(General communication objects)
</h3><p>由于 通用通讯对象十分重要， NMT 主站（ CANopen 主站） 在启动时， 通常都全部或者部分读取 所有从站中 通用通讯对象中的索引， 所以所有的通用通讯对象都必须在CANopen 从站中实现 ，使用者也 必须熟知这些索引地址与其含义。如表所示。</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>Index 索引[HEX]</th>
          <th>Object 对象</th>
          <th>Name 名字</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1000</td>
          <td>VAR变量</td>
          <td>Device type设备类型</td>
      </tr>
      <tr>
          <td>1001</td>
          <td>VAR变量</td>
          <td>Error register错误寄存器</td>
      </tr>
      <tr>
          <td>1002</td>
          <td>VAR变量</td>
          <td>Manufacturer status register制造商状态寄存器</td>
      </tr>
      <tr>
          <td>1003</td>
          <td>ARRAY数组</td>
          <td>Pre-defined error field预定义错误场</td>
      </tr>
      <tr>
          <td>1005</td>
          <td>VAR变量</td>
          <td>COB-ID Sync message同步报文COB标识符</td>
      </tr>
      <tr>
          <td>1006</td>
          <td>VAR变量</td>
          <td>Communication cycle period同步通信循环周期（单位us）</td>
      </tr>
      <tr>
          <td>1007</td>
          <td>VAR变量</td>
          <td>Synchronous windows length同步窗口长度(单位us)</td>
      </tr>
      <tr>
          <td>1008</td>
          <td>VAR变量</td>
          <td>Manufacturer device name制造商设备名称</td>
      </tr>
      <tr>
          <td>1009</td>
          <td>VAR变量</td>
          <td>Manufacturer hardware version制造商硬件版本</td>
      </tr>
      <tr>
          <td>100A</td>
          <td>VAR变量</td>
          <td>Manufacturer software version制造商软件版本</td>
      </tr>
      <tr>
          <td>100C</td>
          <td>VAR变量</td>
          <td>Guard time守护时间（单位ms）</td>
      </tr>
      <tr>
          <td>100D</td>
          <td>VAR变量</td>
          <td>Life time factor寿命因子（单位ms）</td>
      </tr>
      <tr>
          <td>1010</td>
          <td>VAR变量</td>
          <td>Store parameters保存参数</td>
      </tr>
      <tr>
          <td>1011</td>
          <td>VAR变量</td>
          <td>Restore default parameters恢复默认参数</td>
      </tr>
      <tr>
          <td>1012</td>
          <td>VAR变量</td>
          <td>COB-ID time stamp时间报文COB标识符（发送网络时间）</td>
      </tr>
      <tr>
          <td>1013</td>
          <td>VAR变量</td>
          <td>High resolution time stamp高分辨率时间标识</td>
      </tr>
      <tr>
          <td>1014</td>
          <td>VAR变量</td>
          <td>COB-ID emergency紧急报文COB标识符</td>
      </tr>
      <tr>
          <td>1015</td>
          <td>VAR变量</td>
          <td>Inhibit time emergency紧急报文禁止时间（单位100us）</td>
      </tr>
      <tr>
          <td>1016</td>
          <td>ARRAY数组</td>
          <td>Consumer heartbeat time消费者心跳时间间隔(单位ms)</td>
      </tr>
      <tr>
          <td>1017</td>
          <td>VAR变量</td>
          <td>Producer heartbeat time生产者心跳时间间隔（单位ms）</td>
      </tr>
      <tr>
          <td>1018</td>
          <td>RECORD记录</td>
          <td>Identity object厂商ID标识对象</td>
      </tr>
      <tr>
          <td>1019</td>
          <td>VAR变量</td>
          <td>Sync.counter overflow value同步计数溢出值</td>
      </tr>
      <tr>
          <td>1020</td>
          <td>ARRAY数组</td>
          <td>Verify configuration验证配置</td>
      </tr>
      <tr>
          <td>1021</td>
          <td>VAR变量</td>
          <td>Store EDS存储EDS</td>
      </tr>
      <tr>
          <td>1022</td>
          <td>VAR变量</td>
          <td>Storage format存储格式</td>
      </tr>
      <tr>
          <td>1023</td>
          <td>RECORD记录</td>
          <td>OS command操作系统命令</td>
      </tr>
      <tr>
          <td>1024</td>
          <td>VAR变量</td>
          <td>OS command mode操作系统命令模式</td>
      </tr>
      <tr>
          <td>1025</td>
          <td>RECORD记录</td>
          <td>OS debugger interface操作系统调试接口</td>
      </tr>
      <tr>
          <td>1026</td>
          <td>ARRAY数组</td>
          <td>OS prompt操作系统提示</td>
      </tr>
      <tr>
          <td>1027</td>
          <td>ARRAY数组</td>
          <td>Module list模块列表</td>
      </tr>
      <tr>
          <td>1028</td>
          <td>ARRAY数组</td>
          <td>Emergency consumer紧急报文消费者</td>
      </tr>
      <tr>
          <td>1029</td>
          <td>ARRAY数组</td>
          <td>Error behavior错误行为</td>
      </tr>
  </tbody>
</table></div>
<h2 id="制造商特定子协议-manufacturer-specific-profile">制造商特定子协议 (Manufacturer specific Profile)
</h2><p>对象字典索引2000h to 5FFFh为制造商特定子协议，通常是存放所应用子协议的应用数据。而上文所描述的通讯对象子协议区（Communication profile area）是存放这些应用数据的通信参数。比如广州致远电子的XGate-COP10从站模块规定了：</p>
<ul>
<li>RPDO 的通讯参数存放在 1400 h to 15FF h 映射参数存放在 1600 h to 17FF h 数据存放为2000 h 之后厂商自定义区；</li>
<li>TPDO 的通讯参数存放在 1800 h to 19FF h 映射参数存放在 1A00 h to 1BFF h 数据存放为2000 h 之后厂商自定 义区。 对于在设备子协议中未定义的特殊功能，制造商也可以在此区域根据需求定义对象字典对象。因此这个区域对于不同的厂商来说，相同的对象字典项其定义不一定相同。</li>
</ul>
<h2 id="标准化-设备子协议-standardized-profile-area-">标准化 设备子协议 Standardized profile area )
</h2><p>标准化设备子协议，为各种行业不同类型的标准设备定义对象字典中的对象。目前已有十几种为不同类型的设备定义的子协议，例如 DS401 、 DS402 、 DS406 等，其索引值范围为 0x6000 0x9FFF 。 同样，这个区域对于不同 的标准化设备子协议来说，相同的对象字典项其定义不一定相同。</p>
<h1 id="7-网络管理-nmt-network-manag-ement-与-canopen-主站">7. 网络管理 NMT Network manag ement) 与 CANopen 主站
</h1><p>前文所述，一个CANopen 网络中为了保证可靠、可控，必须要 NMT 网络管理 就像一个军队一样，要令行禁止，才能达到稳定、高效的目标。指挥员（ NMT主机）通过发号施令，士兵（ NMT 从机）进行自由俯卧训练，这样整个训练都是有序的。 所以每个 CANopen 从节点的 CANopen 协议栈中，必 须具备 NMT 管理的相应代码，这是 节点具备 CANopen 协议的最基本的要素 。</p>
<h2 id="nmt-节点状态">NMT 节点状态
</h2><p>NMT管理涉及到一个 CANopen 节点从上电开始的 6 钟 状态，包括：</p>
<ul>
<li>初始化 Initializing：节点上电后对功能部件包括 CAN 控制器进行初始化；</li>
<li>应用层复位 Application Reset ：节点中的应用程序复位（开始），比如开关量输出、模拟量输出的初始值；</li>
<li>通讯复位 Communication reset ：节点中的 CANopen 通讯复位（开始），从这个时刻起，此节点就可以进行 CANopen 通讯了。</li>
<li>预操作状态 Pre operational ：节点的 CANopen 通讯处于操作就绪状态，此时此节点不能进行 PDO 通信，而可以进行 SDO 进行参数配置和 NMT 网络管理的操作；</li>
<li>操作状态 operational ：节点收到 NMT 主机发来的启动命令后， CANopen 通讯被激活 PDO 通信启动后 按照对象字典里面规定的规则进行传输，同样 SDO 也可以对节点进行数据传输和参数修改；</li>
<li>停止状态 Stopped 节点收到 NMT 主机发来的停止命令后，节点的 PDO 通信被停止，但 SDO 和 NMT 网络管理依然可以对节点进行操作； 除了初始化状态，NMT 主机通过 NMT 命令可以让网络中任意一个的 CANopen 节点进行其他 5 种状态的切换。如 图 6.2 所示。 当然CANopen 节点也可以程序自动完成这些状态的切换。</li>
</ul>
<p><img src="https://i-blog.csdnimg.cn/direct/27acdc1640994c068f4ffd3e8d4131ae.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="nmt-节点上线报文">NMT 节点上线报文
</h2><p>任何一个CANopen 从站上线后，为了提示主站它已经加入网络（便于热插拔），或者避免与其他从站 Node ID 冲突。这个从站必须发出节点上线报文（ boot up ），如 图 6.3 所示，节点上线报文的 ID 为 700 h +Node ID 数据为 1 个字节 0 。 生产者为 CANopen 从站。 </p>
<p><img src="https://i-blog.csdnimg.cn/direct/e21a36be709a4f92bcc3d49c31a313bf.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="nmt-节点状态与心跳报文">NMT 节点状态与心跳报文
</h2><p>为了监控CANopen 节点是否在线 与目前的节点状态。 CANopen 应用中通常都要求在线上电的从站定时发送状态报文（心跳报文），以便于主站确认从站是否故障、是否脱离网络。 如图 6 4 所示，为心跳报文发送的格式， CANID 与节点上线报文相同 为 700 h +Node ID数据为 1 个字节，代表节点目前的状态， 04 h 为停止状态， 05 h 为操作状态， 7F h 为预操作状态。 </p>
<p><img src="https://i-blog.csdnimg.cn/direct/4bf2f6838b2d471692cc82917750d839.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>CANopen从站按其对象字典中 1017 h 中填写的心跳生产时间（ ms ）进行心跳报文的发送，而 CANopen 主站（ NMT 主站）则会按其 1016h 中填写的心 跳消费时间进行检查，假设超过诺干次心跳消费时间没有收到从站的心跳报文，则认为从站已经离线或者损坏。</p>
<h2 id="nmt-节点守护">NMT 节点守护
</h2><p>在早期CANopen 应用中，还有一种可以 通过轮询模式监视从站状态的节点守护模式它与心跳报文模式二者不能并存 。通过节点守护， MNT 主机可以检查每个节点的当前状态。 由于远程帧在CAN 发展中逐渐被淘汰，而节点守护由于需要更多的主站开销与增加网络负载， CiA 协会已经不建议使用，被心跳报文所取代 。</p>
<h2 id="nmt-节点状态切换命令">NMT 节点状态切换命令
</h2><p>NMT网络管理中，最核心的就是 NMT 节点状态切换命令 ，这是 NMT 主站所 进行网络管理的“命令”报文。 使用者必须牢记这些命令 。 CANID均为 000 ，具备最高的 CAN 优先级。数据为 2 个字节：</p>
<ul>
<li>第 1 个字节代表命令类型： 01h 为启动命令（让节点进入操 作状态）； 02h 为停止命令（让节点进入停止状态）； 80h 为进入预操作状态（让节点进入预操作状态）； 81h 为复位节点应用层（让节点的应用恢复初始状态，比如列车门都恢复打开状态）； 82h 为复位节点通讯（让节点的 CAN 和 CANopen 通讯重新初始化，一般用于总线收到干扰，导致节点总线错误被动，或者总线关闭时）。</li>
<li>第2个字节代表被控制的节点 Node ID，如果要对整个网络所有节点同时进行控制，则这个数值为 0 即可。</li>
</ul>
<h2 id="canopen-主站设备">CANopen 主站设备
</h2><p>通常NMT 主站也 称为 CANoepn 主站， 上文 所述为 CANopen 最基本的 NMT 操作，而作为一个 完整的 CANopen 主站设备，设备模型如 图 6 6 所示。为了满足管理整个 CANopen网络的从站设备，需要具备以下功能：</p>
<ul>
<li>支持 PDO 、 SDO 发送与接收；</li>
<li>支持 NMT 网络管理；</li>
<li>支持 PDO 通信类型并能够支持监控每一个 PDO 目标；</li>
<li>L SS 层设置功能：从站波特率设置、从站节点编号设置；</li>
<li>支持从站管理功能：类型与名称读取、对象字典读写；</li>
<li>紧急报文发送功能；</li>
<li>扩展 CANopen 标准指示灯功能。</li>
</ul>
<p><img src="https://i-blog.csdnimg.cn/direct/5d04981c07d54dafae9e24a2b6a403ae.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>目前有二种形式的主站，一种是可编程控制器PLC 中的一个单元，它的内部集成了CANopen 的主站功能，这个单元能连接到 CANopen 总线，同时因为它是 PLC 中的一个 单元，它能与 PLC 的 CPU 交换数据，因此通过 编写 PLC 程序对 它所连接的 CANopen 从站进行管理和控制。 另一种是通过PC扩展一个CANopen主站通信卡，从而令PC具有管理CANopen通信网络的能力。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/6c147a6ed08d45dcbf2a102b7605e114.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="8-过程数据对象-pdo-process-data-object">8. 过程数据对象 PDO (Process data object)
</h1><p>如前文所述PDO属于过程数据用来传输实时数据，即单向传输，无需接收节点回应CAN报文来确认，从通讯术语上来说是属于“生产消费”模型PDO，如图 7.1所示，就像食品销售柜台，生产者摆出“食品”，但只有“需要”的消费者才会来买，没有指向性。 数据长度被限制为1~8 字节。最多只要1帧就可以把一条信息或者一个变量传递结束。</p>
<h2 id="pdo-的-can-id-定义">PDO 的 CAN-ID 定义
</h2><p>PDO通信比较灵活，广义上只要符合 PDO 范围内的所有 CAN-ID 都可以作为节点自身的 TPDO 或者 RPDO 使用 ，也称为 COB-ID ，不受功能码和 Node-ID 限制， 如图所示。<img src="https://i-blog.csdnimg.cn/direct/c13642423f0040d594342ec1deb94bcf.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>而在PDO 预定义中，人为规定了 TPDO 和 RPDO ，规定了 Node ID 在 PDO 中的位置，规定了 PDO 的编号，如表所示。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/8be0b5574fdc42a9808cf1914cb6dca2.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>PDO 分为 TPDO（发送 PDO）和(接收 RPDO)，发送和接收是以 CANopen 节点自身 为参考（如果 CAN 主站或者其他从站就相反）。TPDO 和 RPDO 分别有 4 个数据对象，每 种数据对象就是 1 条 CAN 报文封装，这些都是数据收发的容器。 <strong>当然，如果某个节点需要传递的资源特别多，则有出现例如 TPDO5 之类的数据对象， 而它们的 CAN-ID 定义就需要打破预定义的规则，比如我们可以定义 Node-ID 为 1 的节点 中 TPDO5 是 182h，这里的 PDO 的 COB-ID 中的低 7 位不再是表示 Node-ID。其实所有的 PDO 的 COB-ID 与 Node-ID 无必然规则上的联系。</strong></p>
<h2 id="pdo-的传输形式">PDO 的传输形式
</h2><p>PDO 的两种传输方式：同步传输和异步传输。 如图 7.3 所示，1、2 为异步传输，3、4 为同步传输。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/09bd423b37684e62baa593a216deff79.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>
<p>异步传输（由特定事件触发） 其触发方式可有两种，第一种是由设备子协议中规定的对象特定事件来触发（例如，定时传输，数据变化传输等）。第二种是通过发送与PDO的COB-ID相同的远程帧来触发PDO的发送。目前应用中的异步传输基本都采用第一种。</p>
</li>
<li>
<p>同步传输（通过接收同步对象实现同步） 同步传输就是通过同步报文让所有节点能在同一时刻进行上传数据或者执行下达的应用指令，可以有效避免异步传输导致的应用逻辑混乱和总线负载不平衡的问题。一般发送同步报文的节点是NMT主机。 同步传输又可分为周期传输（循环）和非周期传输（无循环）。周期传输则是通过接收同步对象（SYNC）来实现，可以设置1~240个同步对象触发。 非周期传输是由远程帧预触发或者由设备子协议中规定的对象特定事件预触发传送。</p>
<h2 id="pdo-的通信参数">PDO 的通信参数
</h2><p>PDO通信参数，定义了该设备所使用的COB-ID、传输类型、定时周期等。RPDO通讯参数位于对象字典索引的1400h to 15FFh，TPDO通讯参数位于对象字典索引的1800h to 19FFh。每条索引代表一个PDO的通信参数集，其中的子索引分别指向具体的各种参数。如表 7.2所示。</p>
</li>
</ul>
<p><img src="https://i-blog.csdnimg.cn/direct/ace0acaaa98a47b3bbd06fe7eee3e2eb.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<ul>
<li>
<p>Number of entries 参数条目数量：即本索引中有几条参数；</p>
</li>
<li>
<p>COB-ID：即这个 PDO 发出或者接收的对应CAN帧ID；</p>
</li>
<li>
<p>发送类型：即这个 PDO 发送或者接收的传输形式，通常使用循环同步和异步制造 商特定事件较多；</p>
</li>
<li>
<p>Inhibit time 生产禁止约束时间(1/10ms)：约束 PDO 发送的最小间隔，避免导致总 线负载剧烈增加，比如数字量输入过快，导致状态改变发送的 TPDO 频繁发送， 总线负载加大，所以需要一个约束时间来进行“滤波”，这个时间单位为 0.1ms；</p>
</li>
<li>
<p>Event timer 事件定时器触发的时间(单位 ms)：定时发送的 PDO，它的定时时间， 如果这个时间为 0，则这个 PDO 为事件改变发送。</p>
</li>
<li>
<p>SYNC start value 同步起始值：同步传输的 PDO，收到诺干个同步包后，才进行发 送，这个同步起始值就是同步包数量。比如设置为 2，即收到 2 个同步包后才进行 发送。</p>
<h2 id="pdo-的映射参数">PDO 的映射参数
</h2><p>PDO 映射参数是初学者学习 CANopen 时的一个难点，它包含了一个对象字典中的对 象列表，这些对象映射到相应的 PDO，其中包括数据的长度（单位，位），对于生产者和 消费者都必须要知道这个映射参数，才能够正确的解释 PDO 内容。就是将通信参数、应用 数据和具体 CAN 报文中数据联系起来。 RPDO 通讯参数 1400h to 15FFh，映射参数 1600h to 17FFh，数据存放为 2000h 之后厂商 自定义区域；TPDO 通讯参数 1800h to 19FFh，映射参数 1A00h to 1BFFh，数据存放为 2000h 之 后厂商自定义区域。 为了更加直观地表现映射，表 7.3 模拟 TPDO1，将参数、应用数据、CAN 报文数据联 合起来展示，不同的映射采用不同的颜色。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/3501ae19c9164c448183e56de2d99e52.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
</li>
</ul>
<h1 id="9-服务数据对象-sdoservice-data-object">9. 服务数据对象 SDO（Service data object）
</h1><p>SDO 主要用于 CANopen 主站对从节点的参数配置。服务确认是 SDO 的最大的特点， 为每个消息都生成一个应答，确保数据传输的准确性。这就像快递，需要收方签收后，给寄方发送一个已经签收的确认才算完成一次投递。 在一个 CANopen 系统中，通常 CANopen 从节点作为 SDO 服务器，CANopen 主节点 作为客户端（称为 CS 通讯）。SDO 客户端通过索引和子索引，能够访问 SDO 服务器上的对 象字典。这样 CANopen 主节点可以访问从节点的任意对象字典项的参数，并且 SDO 也可以 传输任何长度的数据（当数据长度超过 4 个字节时就拆分成多个报文来传输）。</p>
<h2 id="通讯原则communication-principle">通讯原则（communication principle）
</h2><p>SDO 的通讯原则非常单一，发送方（客户端）发送 CAN-ID 为 600h+Node-ID 的报文， 其中 Node-ID 为接收方（服务器）的节点地址，数据长度均为 8 字节； 接收方（服务器）成功接收后，回应 CAN-ID 为 580h+Node-ID 的报文。这里的 Node-ID 依然是接收方（服务器）的节点地址，数据长度均为 8 字节。如图所示。<img src="https://i-blog.csdnimg.cn/direct/84d4966a06fd44aa8a0d15822289aa29.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="快速-sdo-协议expedited-sdo-protocol">快速 SDO 协议(Expedited SDO protocol)
</h2><p>最常用最常见的 SDO 协议是快速 SD O 所谓 快速 就是 1 次 来回 就 搞定 。 前提是读取和写入的值不能 大于 32 位 。 如 图 8 3 所示 为 快速 SDO 协议 的 示意图 。 命令中直接包含了要读写的索引 、 子索引 、 数据 。 可谓 直接 命中 。 快速SDO 的 难点 在于 CS 命令符的记忆需要读者收藏这个示意图 。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/d28536cb7ee7458090fb659546d3d658.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>通过快速 SDO 可以直接对CANopen节点的对象字典中的值进行读取和修改所以在做参数配置之外也经常作为关键性数据传输之用 。 比如CANopen控制机器人的电机转动角度时就使用SDO来传输保证可靠 到达 。</p>
<h2 id="普通-sdo-协议normal-sdo-protocol">普通 SDO 协议(Normal SDO protocol)
</h2><p>当需要传输的值超过32位时就不能使用快速SDO传输 。 必须使用普通 SDO 进行分帧传输 。 在应用中较少用到一般用于CANopen节点的<code>&lt;u&gt;</code>程序固件升级<code>&lt;/u&gt;</code>或者做网关转换MVB总线之类数据最大可达256 位 的 应用 。 普通SDO协议难点在于分包逻辑与CS命令符的变化 。 依然难以记忆需要读者将以下示意图进行收藏 。 当然普通SDO的CAN帧ID与快速SDO相同依然发送方客户端发送的报文CAN-ID为600h +Node-ID 接收 方服务器成功接收后回应CAN-ID 为 580h +Node-ID 的报文 。</p>
<ol>
<li>下载协议 download protocol 如 图 8 4 所示 。<img src="https://i-blog.csdnimg.cn/direct/496e8ad4ce0d46a2851bd019039662f4.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></li>
<li>上传协议 upload protocol 如 图 8 5 所示 。 <img src="https://i-blog.csdnimg.cn/direct/2fef7942c5094bbdac66dfe560363bf6.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></li>
</ol>
<h1 id="10-特殊协议special-protocols">10. 特殊协议（Special protocols）
</h1><ol>
<li>为了方便CANopen主站对从站管理。在CANopen协议中，已经为特殊的功能预定义了COB-ID，其主要有以下几种特殊报文。</li>
</ol>
<h1 id="11-同步协议-sync-protocol">11. 同步协议 Sync protocol
</h1><p>同步（SYNC），该报文对象主要实现整个网络的同步传输，就像阅兵分列式上的方阵，所有士兵迈着整齐的步伐行进。 每个节点都以该同步报文作为PDO触发参数，因此该同步报文的COB-ID 具有比较高的优先级以及最短的传输时间。 一般选用80h作为同步报文的CAN-ID，如图所示。 <img src="https://i-blog.csdnimg.cn/direct/b48fc7e75c304f3a98b29159fe50bab5.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>一般同步报文由 NMT 主机发出，CAN 报文的数据为 0 字节。但如果一个网络内有 2 个同步机制，就需要设置不同的同步节拍，比如某些节点按 1 个同步帧发送 1 次 PDO，其 他的节点收到2个同步帧才发送1此PDO，所以这里PDO参数中的同步起始值就起了作用。 在同步协议中，有 2 个约束条件：</p>
<ul>
<li>同步窗口时间：索引 1007h约束了同步帧发送后，从节点发送 PDO 的时效，即在 这个时间内发送的 PDO 才有效，超过时间的 PDO 将被丢弃；</li>
<li>通讯循环周期：索引 1006h规定了同步帧的循环周期。</li>
</ul>
<h1 id="12-时间戳协议time-stamp-protocol">12. 时间戳协议（Time-stamp protocol）
</h1><p>时间标记对象（Time Stamp），NMT 主机发送自身的时钟，为网络各个节点提供公共的时间参考，即网络对时。这在故障诊断中非常需要，比如列车中火灾报警，检修人员需要准确获知报警的时刻，然后关联查看其它设备在这个时刻的工作状态。 时间戳协议采用广播方式，无需节点应答，CAN-ID 为100h，数据长度为 6，数据为当前时刻与1984年1 月 1 日 0 时的时间差。如图所示。节点将此时间存储在对象字典 1012h 的索引中。</p>
<p><img src="https://i-blog.csdnimg.cn/direct/28eccf37378f43d8b6fae83a2c15592a.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">DataTime</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">uint32</span> <span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">da</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">canopen_data</span><span class="p">;</span><span class="c1">// 定义网络的日期；
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">canopen_msecond</span><span class="p">;</span><span class="c1">// 定义网络的时间（ ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//计算年
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">n</span><span class="o">=</span> <span class="p">(</span><span class="n">canopen_data</span><span class="o">+</span><span class="mi">671</span><span class="p">)</span><span class="o">/</span><span class="mi">1461</span><span class="p">;</span><span class="c1">// 求有多少个 2 月 29 日
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Year</span><span class="o">=</span><span class="p">(</span><span class="n">canopen_data</span> <span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">365</span><span class="o">+</span><span class="mi">1984</span><span class="p">;</span><span class="c1">// 得到年
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">((</span><span class="n">c</span> <span class="n">anopen_data</span> <span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="mi">365</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Year</span><span class="o">=</span><span class="n">Year</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//计算月日
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">((</span><span class="n">Year</span><span class="o">%</span><span class="mi">400</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="n">Year</span><span class="o">%</span><span class="mi">4</span><span class="o">==</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="n">Year</span><span class="o">%</span><span class="mi">100</span><span class="o">!=</span><span class="mi">0</span><span class="p">))</span><span class="c1">// 判断闰年
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">29</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">28</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">da</span><span class="o">=</span><span class="n">canopen_data</span> <span class="o">--</span><span class="p">((</span><span class="n">canopen_data</span> <span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">365</span><span class="p">)</span><span class="o">*</span><span class="mi">365</span> <span class="n">n</span><span class="p">;</span><span class="c1">// 减去该年前的前天，得到改年的第几天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">12</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">da</span><span class="o">&gt;</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">da</span><span class="o">=</span><span class="n">da</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="c1">// 让天数减去每个月的天数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">da</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Month</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Day</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">da</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">da</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">//如果得到小于或等于该月的天数，则可以确定为哪一天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Month</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Day</span><span class="o">=</span><span class="n">da</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="err">计算时分秒</span>
</span></span><span class="line"><span class="cl">    <span class="n">canopen_msecond</span><span class="o">=</span><span class="n">canopen_msecond</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span><span class="c1">// 把毫秒转换为秒
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Hour</span><span class="o">=</span><span class="n">canopen_msecond</span><span class="o">%</span><span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span><span class="o">/</span><span class="mi">3600</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Minute</span><span class="o">=</span><span class="n">canopen_msecond</span><span class="o">%</span><span class="mi">3600</span><span class="o">/</span><span class="mi">60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Second</span><span class="o">=</span><span class="n">canopen_msecond</span><span class="o">%</span><span class="mi">60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="13-紧急报文协议emergency-protocol">13. 紧急报文协议（Emergency protocol）
</h2><p>紧急事件对象（Emergency），是当设备内部发生错误，触发该对象，发送设备内部错误 代码，提示 NMT 主站。紧急报文属于诊断性报文，一般不会影响 CANopen 通讯，其 CAN-ID 存储在 1014h的索引中，一般会定义为 080h +node-ID，数据包含 8 个字节，如图所示。 <img src="https://i-blog.csdnimg.cn/direct/4064ac5ef0aa449d8d894525c2bc40b4.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
>编辑</p>
<p>其中包括 EEC：紧急时间错误代码，ER：错误寄存器，MEF：厂商自定义的错误代码。 当然这些都需要查表才能获知，进行诊断。</p>
<p>Emergency error codes（紧急报文错误代码）<img src="https://i-blog.csdnimg.cn/direct/f1bfe574d365403a8318d368726ed7a4.png"
	
	
	
	loading="lazy"
	
	
><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
>编辑</p>
<p>与 PDO 的生产禁止时间类似，紧急报文也有生产禁止时间，存储在对象字典的 1015h 中，为了限制节点不断发送紧急报文，导致总线负载过大。</p>
<p>在STM32中使用块传输（Block Transfer）下载程序的一个实例可以通过以下步骤实现：</p>
<h3 id="1-初始化sdo块下载">1. 初始化SDO块下载
</h3><p>首先，主节点（STM32）需要告诉从节点（目标设备）它想要写入多少个字节的数据。这通常通过发送一个初始化下载请求来完成。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 假设待写入的数据是 &#34;0123456789aaabbbcccddd0&#34;，映射在索引 0x2007，子索引 0x01
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">write_net_block_buf</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;0123456789aaabbbcccddd0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">UNS16</span> <span class="n">index</span> <span class="o">=</span> <span class="mh">0x2007</span><span class="p">;</span> <span class="c1">// 目标设备的SDO索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">subIndex</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span> <span class="c1">// 目标设备的SDO子索引
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS32</span> <span class="n">count</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">write_net_block_buf</span><span class="p">);</span> <span class="c1">// 待写入数据的总字节数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 发送初始化下载请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// CCS = 6, CC = 0, S = 1, CS = 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span> <span class="c1">// 索引低字节
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span> <span class="c1">// 索引高字节
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">subIndex</span><span class="p">;</span> <span class="c1">// 子索引
</span></span></span><span class="line"><span class="cl"><span class="c1">// 将待写入数据的总字节数分割成4个字节
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">UNS8</span><span class="p">)(</span><span class="n">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">buf</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">UNS8</span><span class="p">)(</span><span class="n">count</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">buf</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">UNS8</span><span class="p">)(</span><span class="n">count</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">buf</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">UNS8</span><span class="p">)(</span><span class="n">count</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 发送SDO请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">send_SDO_request</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span> <span class="c1">// 假设send_SDO_request是发送SDO请求的函数
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="2-从节点响应">2. 从节点响应
</h3><p>从节点收到初始化下载请求后，会响应主节点，告知它已经准备好接收数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 从节点响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">response</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">SDO_BSS_INITIATE_DOWNLOAD_RESPONSE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">subIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">SDO_BLOCK_SIZE</span><span class="p">;</span> <span class="c1">// 块大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">response</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 发送SDO响应
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">send_SDO_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">response</span><span class="p">));</span> <span class="c1">// 假设send_SDO_response是发送SDO响应的函数
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="3-主节点发送数据">3. 主节点发送数据
</h3><p>主节点收到从节点的响应后，开始逐条发送数据，无需等待从节点的响应。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="c1">// 发送数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">seqNo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 序列号从0开始
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">blockBuf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// 块缓冲区
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS16</span> <span class="n">dataOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 数据偏移量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="n">dataOffset</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 计算当前块的数据长度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">UNS8</span> <span class="n">blockSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">dataOffset</span> <span class="o">&gt;</span> <span class="n">SDO_BLOCK_SIZE</span><span class="p">)</span> <span class="o">?</span> <span class="nl">SDO_BLOCK_SIZE</span> <span class="p">:</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">dataOffset</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 将数据复制到块缓冲区
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">memcpy</span><span class="p">(</span><span class="n">blockBuf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">write_net_block_buf</span> <span class="o">+</span> <span class="n">dataOffset</span><span class="p">,</span> <span class="n">blockSize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 设置序列号和块传输标志
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">blockBuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">blockSize</span> <span class="o">==</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">dataOffset</span><span class="p">))</span> <span class="o">?</span> <span class="p">(</span><span class="mh">0x80</span> <span class="o">|</span> <span class="n">seqNo</span><span class="p">)</span> <span class="o">:</span> <span class="n">seqNo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 发送SDO数据块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">send_SDO_block</span><span class="p">(</span><span class="n">blockBuf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">blockBuf</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataOffset</span> <span class="o">+=</span> <span class="n">blockSize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">seqNo</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="4-从节点确认数据">4. 从节点确认数据
</h3><p>从节点接收到每个数据块后，需要确认收到的数据量。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="c1">// 从节点确认
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">ack</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">ack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">SDO_BCS_DOWNLOAD_RESPONSE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ack</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">seqNo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ack</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">SDO_BLOCK_SIZE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ack</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ack</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ack</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">ack</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">ack</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 发送SDO确认
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">send_SDO_ack</span><span class="p">(</span><span class="n">ack</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ack</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="5-完成块下载">5. 完成块下载
</h3><p>当所有数据块都发送完毕后，主节点需要告知从节点整个写入操作完成。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="c1">// 完成块下载
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">UNS8</span> <span class="n">endBlockDownload</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="n">endBlockDownload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">SDO_BCS_END_DOWNLOAD_REQUEST</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 发送结束块下载请求
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">send_SDO_request</span><span class="p">(</span><span class="n">endBlockDownload</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">endBlockDownload</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="
	
	
	
	loading="lazy"
	
	
></p>
<p>以上步骤展示了在STM32中使用SDO块传输下载程序的基本流程。需要注意的是，实际的函数名称和实现可能会根据所使用的CANopen库或框架有所不同。</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/test-chinese/">
        
        
            <div class="article-image">
                <img src="/p/test-chinese/helena-hertz-wWZzXlDpMog-unsplash.46f61e8ea6a2df8fc5bf1d24a17c44a6_hu_57b7cab9514860c.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Chinese Test"
                        data-key="test-chinese" 
                        data-hash="md5-RvYejqai34/Fvx0koXxEpg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Chinese Test</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/placeholder-text/">
        
        
            <div class="article-image">
                <img src="/p/placeholder-text/matt-le-SJSpo9hQf7s-unsplash.8eae06664ddfb3e8dc6e000756cb703b_hu_cc847465c05fc251.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Placeholder Text"
                        
                        data-hash="md5-jq4GZk3fs&#43;jcbgAHVstwOw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Placeholder Text</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/emoji-support/">
        
        
            <div class="article-image">
                <img src="/p/emoji-support/the-creative-exchange-d2zvqp3fpro-unsplash.60116b1ccfc8632e9a65f7d51df3efc2_hu_c1cfd6b8275d624a.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Emoji Support"
                        
                        data-hash="md5-YBFrHM/IYy6aZffVHfPvwg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Emoji Support</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Aiwolf
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
